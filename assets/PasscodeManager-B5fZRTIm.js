import{g as G,l as U,h as Z,j as s,i as ee,m as K,n as se,V as te,W as ae,w as I,b as re,u as oe,x as B,J as A,K as R,Q as T,y as D,Y as M}from"./index-Cyp6Y-yQ.js";import{r}from"./vendor-DZwePlub.js";import{B as j}from"./button-D2bx5s4T.js";import{I as v}from"./input-BWl_fD1d.js";import{T as ce}from"./trash-2-B9KSiUET.js";const _=G("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);var k="Switch",[ne,ve]=ee(k),[ie,de]=ne(k),L=r.forwardRef((c,a)=>{const{__scopeSwitch:e,name:i,checked:n,defaultChecked:x,required:d,disabled:l,value:u="on",onCheckedChange:y,form:p,...w}=c,[b,h]=r.useState(null),f=U(a,P=>h(P)),o=r.useRef(!1),g=b?p||!!b.closest("form"):!0,[m,C]=Z({prop:n,defaultProp:x??!1,onChange:y,caller:k});return s.jsxs(ie,{scope:e,checked:m,disabled:l,children:[s.jsx(K.button,{type:"button",role:"switch","aria-checked":m,"aria-required":d,"data-state":O(m),"data-disabled":l?"":void 0,disabled:l,value:u,...w,ref:f,onClick:se(c.onClick,P=>{C(S=>!S),g&&(o.current=P.isPropagationStopped(),o.current||P.stopPropagation())})}),g&&s.jsx(q,{control:b,bubbles:!o.current,name:i,value:u,checked:m,required:d,disabled:l,form:p,style:{transform:"translateX(-100%)"}})]})});L.displayName=k;var F="SwitchThumb",H=r.forwardRef((c,a)=>{const{__scopeSwitch:e,...i}=c,n=de(F,e);return s.jsx(K.span,{"data-state":O(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:a})});H.displayName=F;var le="SwitchBubbleInput",q=r.forwardRef(({__scopeSwitch:c,control:a,checked:e,bubbles:i=!0,...n},x)=>{const d=r.useRef(null),l=U(d,x),u=te(e),y=ae(a);return r.useEffect(()=>{const p=d.current;if(!p)return;const w=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(w,"checked").set;if(u!==e&&h){const f=new Event("click",{bubbles:i});h.call(p,e),p.dispatchEvent(f)}},[u,e,i]),s.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:e,...n,tabIndex:-1,ref:l,style:{...n.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});q.displayName=le;function O(c){return c?"checked":"unchecked"}var V=L,ue=H;const W=r.forwardRef(({className:c,...a},e)=>s.jsx(V,{className:I("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",c),...a,ref:e,children:s.jsx(ue,{className:I("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));W.displayName=V.displayName;const xe=({onUnlock:c})=>{const{toast:a}=re(),{t:e}=oe(),[i,n]=r.useState(""),[x,d]=r.useState(""),[l,u]=r.useState(!1),[y,p]=r.useState(!1),[w,b]=r.useState(!1),[h,f]=r.useState(""),[o,g]=r.useState(""),[m,C]=r.useState(""),[P,S]=r.useState(!1);r.useEffect(()=>{const t=localStorage.getItem("app-passcode")!==null;u(t),z()},[]);const z=async()=>{if(window.PublicKeyCredential)try{const t=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();S(t)}catch{S(!1)}},N=()=>{const t=localStorage.getItem("app-passcode");if(!t){d(e("noPasscodeSet"));return}const E=atob(t);i===E?(sessionStorage.setItem("app-authenticated","true"),d(""),n(""),c()):d(e("incorrectPasscode"))},J=async()=>{try{await navigator.credentials.get({publicKey:{challenge:new Uint8Array(32),timeout:6e4,userVerification:"required"}})&&(a({title:e("biometricSuccess")}),c())}catch{a({title:e("biometricFailed"),variant:"destructive"})}},Q=()=>{if(!o||o!==m){a({title:e("error"),description:e("passcodesDontMatchOrEmpty"),variant:"destructive"});return}if(o.length<4){a({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(o)),u(!0),g(""),C(""),a({title:e("passcodeEnabled"),description:e("passcodeEnabledDescription")})},X=()=>{const t=localStorage.getItem("app-passcode");if(!t)return;const E=atob(t);if(h!==E){a({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}if(!o||o!==m){a({title:e("error"),description:e("newPasscodesDontMatchOrEmpty"),variant:"destructive"});return}if(o.length<4){a({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(o)),f(""),g(""),C(""),p(!1),a({title:e("passcodeChanged"),description:e("passcodeChangedDescription")})},Y=()=>{const t=localStorage.getItem("app-passcode");if(!t||atob(t)!==h){a({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}localStorage.removeItem("app-passcode"),u(!1),f(""),a({title:e("passcodeDisabled"),description:e("passcodeDisabledDescription")})},$=sessionStorage.getItem("app-authenticated");return l&&!$?s.jsxs(B,{className:"max-w-sm mx-auto",children:[s.jsxs(A,{children:[s.jsx(R,{children:e("unlockApp")}),s.jsx(T,{children:e("enterPasscodeToContinue")})]}),s.jsxs(D,{className:"space-y-4",children:[s.jsx(v,{type:w?"text":"password",placeholder:e("enterPasscode")||"Enter your 4-digit passcode",value:i,onChange:t=>n(t.target.value),onKeyDown:t=>t.key==="Enter"&&N(),autoFocus:!0}),x&&s.jsx("p",{className:"text-red-500",children:x}),s.jsxs(j,{className:"w-full",onClick:N,children:[s.jsx(_,{className:"mr-2 w-4 h-4"}),e("unlock")]}),P&&s.jsx(j,{variant:"outline",className:"w-full",onClick:J,children:e("useBiometric")}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:e("showPasscode")}),s.jsx(W,{checked:w,onCheckedChange:b})]})]})]}):s.jsxs(B,{className:"max-w-md mx-auto mt-6",children:[s.jsxs(A,{children:[s.jsx(R,{children:e("passcodeSettings")}),s.jsx(T,{children:e("secureAppWithPasscode")})]}),s.jsx(D,{className:"space-y-4",children:l?y?s.jsxs(s.Fragment,{children:[s.jsx(v,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:h,onChange:t=>f(t.target.value)}),s.jsx(v,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:o,onChange:t=>g(t.target.value)}),s.jsx(v,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:m,onChange:t=>C(t.target.value)}),s.jsxs(j,{className:"w-full",onClick:X,children:[s.jsx(M,{className:"mr-2 w-4 h-4"}),e("saveChanges")]})]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:h,onChange:t=>f(t.target.value)}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs(j,{variant:"default",onClick:()=>p(!0),children:[s.jsx(_,{className:"mr-2 w-4 h-4"}),e("changePasscode")]}),s.jsxs(j,{variant:"destructive",onClick:Y,children:[s.jsx(ce,{className:"mr-2 w-4 h-4"}),e("disablePasscode")]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(v,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:o,onChange:t=>g(t.target.value)}),s.jsx(v,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:m,onChange:t=>C(t.target.value)}),s.jsxs(j,{className:"w-full",onClick:Q,children:[s.jsx(M,{className:"mr-2 w-4 h-4"}),e("enablePasscode")]})]})})]})};export{xe as PasscodeManager};

import{r,j as s,b0 as F,b1 as W,b2 as k,E as S,aH as z}from"./react-ngz0KEri.js";import{g as N,b as G,u as J,C as E,i as I,j as D,k as A,h as B}from"./index-q3cQ66e3.js";import{B as n}from"./button-BhbNX3hy.js";import{I as c}from"./input-DHhPsQaB.js";import"./vendor-CfMdQmI6.js";const K=r.forwardRef(({className:i,...t},e)=>s.jsx(F,{className:N("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",i),...t,ref:e,children:s.jsx(W,{className:N("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));K.displayName=F.displayName;const $=({onUnlock:i})=>{const{toast:t}=G(),{t:e}=J(),[x,v]=r.useState(""),[b,m]=r.useState(""),[w,g]=r.useState(!1),[M,j]=r.useState(!1),[C,T]=r.useState(!1),[l,d]=r.useState(""),[o,u]=r.useState(""),[p,h]=r.useState(""),[U,P]=r.useState(!1);r.useEffect(()=>{const a=localStorage.getItem("app-passcode")!==null;g(a),L()},[]);const L=async()=>{if(window.PublicKeyCredential)try{const a=await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();P(a)}catch{P(!1)}},y=()=>{const a=localStorage.getItem("app-passcode");if(!a){m(e("noPasscodeSet"));return}const f=atob(a);x===f?(sessionStorage.setItem("app-authenticated","true"),m(""),v(""),i()):m(e("incorrectPasscode"))},R=async()=>{try{await navigator.credentials.get({publicKey:{challenge:new Uint8Array(32),timeout:6e4,userVerification:"required"}})&&(t({title:e("biometricSuccess")}),i())}catch{t({title:e("biometricFailed"),variant:"destructive"})}},H=()=>{if(!o||o!==p){t({title:e("error"),description:e("passcodesDontMatchOrEmpty"),variant:"destructive"});return}if(o.length<4){t({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(o)),g(!0),u(""),h(""),t({title:e("passcodeEnabled"),description:e("passcodeEnabledDescription")})},O=()=>{const a=localStorage.getItem("app-passcode");if(!a)return;const f=atob(a);if(l!==f){t({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}if(!o||o!==p){t({title:e("error"),description:e("newPasscodesDontMatchOrEmpty"),variant:"destructive"});return}if(o.length<4){t({title:e("error"),description:e("passcodeMinLength"),variant:"destructive"});return}localStorage.setItem("app-passcode",btoa(o)),d(""),u(""),h(""),j(!1),t({title:e("passcodeChanged"),description:e("passcodeChangedDescription")})},V=()=>{const a=localStorage.getItem("app-passcode");if(!a||atob(a)!==l){t({title:e("error"),description:e("currentPasscodeIncorrect"),variant:"destructive"});return}localStorage.removeItem("app-passcode"),g(!1),d(""),t({title:e("passcodeDisabled"),description:e("passcodeDisabledDescription")})},q=sessionStorage.getItem("app-authenticated");return w&&!q?s.jsxs(E,{className:"max-w-sm mx-auto",children:[s.jsxs(I,{children:[s.jsx(D,{children:e("unlockApp")}),s.jsx(A,{children:e("enterPasscodeToContinue")})]}),s.jsxs(B,{className:"space-y-4",children:[s.jsx(c,{type:C?"text":"password",placeholder:e("enterPasscode")||"Enter your 4-digit passcode",value:x,onChange:a=>v(a.target.value),onKeyDown:a=>a.key==="Enter"&&y(),autoFocus:!0}),b&&s.jsx("p",{className:"text-red-500",children:b}),s.jsxs(n,{className:"w-full",onClick:y,children:[s.jsx(k,{className:"mr-2 w-4 h-4"}),e("unlock")]}),U&&s.jsx(n,{variant:"outline",className:"w-full",onClick:R,children:e("useBiometric")}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{children:e("showPasscode")}),s.jsx(K,{checked:C,onCheckedChange:T})]})]})]}):s.jsxs(E,{className:"max-w-md mx-auto mt-6",children:[s.jsxs(I,{children:[s.jsx(D,{children:e("passcodeSettings")}),s.jsx(A,{children:e("secureAppWithPasscode")})]}),s.jsx(B,{className:"space-y-4",children:w?M?s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:l,onChange:a=>d(a.target.value)}),s.jsx(c,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:o,onChange:a=>u(a.target.value)}),s.jsx(c,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:p,onChange:a=>h(a.target.value)}),s.jsxs(n,{className:"w-full",onClick:O,children:[s.jsx(S,{className:"mr-2 w-4 h-4"}),e("saveChanges")]})]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("currentPasscode")||"Enter current passcode",value:l,onChange:a=>d(a.target.value)}),s.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[s.jsxs(n,{variant:"default",onClick:()=>j(!0),children:[s.jsx(k,{className:"mr-2 w-4 h-4"}),e("changePasscode")]}),s.jsxs(n,{variant:"destructive",onClick:V,children:[s.jsx(z,{className:"mr-2 w-4 h-4"}),e("disablePasscode")]})]})]}):s.jsxs(s.Fragment,{children:[s.jsx(c,{type:"password",placeholder:e("newPasscode")||"Enter new 4-digit passcode",value:o,onChange:a=>u(a.target.value)}),s.jsx(c,{type:"password",placeholder:e("confirmPasscode")||"Confirm new passcode",value:p,onChange:a=>h(a.target.value)}),s.jsxs(n,{className:"w-full",onClick:H,children:[s.jsx(S,{className:"mr-2 w-4 h-4"}),e("enablePasscode")]})]})})]})};export{$ as PasscodeManager};

import{r as o,j as e,aT as re,aU as le,aV as ne,aW as ce,aX as pe,aY as de,aZ as ue,a_ as me,a$ as ge}from"./react-ngz0KEri.js";import{B as j}from"./button-BhbNX3hy.js";import{g as X,u as Z,b as ee,C as P,i as E,j as R,k as _,h as T,l as fe}from"./index-q3cQ66e3.js";import{PasscodeManager as he}from"./PasscodeManager-CJm_VcXt.js";import{E as xe,U as Se}from"./vendor-CfMdQmI6.js";import{I as Q}from"./input-DHhPsQaB.js";const ve=xe("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ae=o.forwardRef(({className:f,variant:c,...n},h)=>e.jsx("div",{ref:h,role:"alert",className:X(ve({variant:c}),f),...n}));ae.displayName="Alert";const ye=o.forwardRef(({className:f,...c},n)=>e.jsx("h5",{ref:n,className:X("mb-1 font-medium leading-none tracking-tight",f),...c}));ye.displayName="AlertTitle";const oe=o.forwardRef(({className:f,...c},n)=>e.jsx("div",{ref:n,className:X("text-sm [&_p]:leading-relaxed",f),...c}));oe.displayName="AlertDescription";const je="YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com",se="YOUR_GOOGLE_API_KEY",we="https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/drive.readonly",Ie=["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"],Ne="picker",ke=({autoExport:f,userEmail:c})=>{const[n,h]=o.useState(!1),[p,k]=o.useState(!1),[A,W]=o.useState(!1),[V,Y]=o.useState(!1),[J,O]=o.useState(!1),[G,w]=o.useState([]),{t}=Z(),{toast:l}=ee(),K=o.useRef(!1),F=o.useRef(null);o.useEffect(()=>{const s=document.createElement("script");s.src="https://apis.google.com/js/api.js",s.async=!0,s.onload=()=>{window.gapi.load("client:auth2",g),window.gapi.load(Ne,()=>Y(!0))},document.body.appendChild(s);function g(){window.gapi.client.init({apiKey:se,clientId:je,discoveryDocs:Ie,scope:we}).then(()=>{W(!0);const r=window.gapi.auth2.getAuthInstance();O(r.isSignedIn.get()),r.isSignedIn.listen(d=>{O(d),d?(F.current=r.currentUser.get().getAuthResponse().access_token,$()):(F.current=null,w([]))}),r.isSignedIn.get()&&(F.current=r.currentUser.get().getAuthResponse().access_token,$())}).catch(r=>{console.error("Google API init error",r),l({title:"Google API Initialization Failed",description:"Failed to load Google Drive integration.",variant:"destructive"})})}},[l]);const q=()=>{A&&window.gapi.auth2.getAuthInstance().signIn()},H=()=>{A&&window.gapi.auth2.getAuthInstance().signOut()},$=()=>{A&&window.gapi.client.drive.files.list({pageSize:10,fields:"files(id, name, createdTime)",q:"mimeType='application/json' and name contains 'finance-backup'",orderBy:"createdTime desc"}).then(s=>{w(s.result.files||[])}).catch(s=>{l({title:t("error")||"Error",description:t("failedToListBackups")||"Failed to list backup files from Google Drive.",variant:"destructive"}),console.error(s)})},u=()=>{if(!A){l({title:t("googleApiNotReady")||"Google API Not Ready",description:t("tryAgainLater")||"Please try again later.",variant:"destructive"});return}h(!0);try{const s=JSON.parse(localStorage.getItem("expenses")||"[]"),g=JSON.parse(localStorage.getItem("income")||"[]"),r=JSON.parse(localStorage.getItem("finance-notes")||"[]"),d=JSON.parse(localStorage.getItem("passcodes")||"[]"),i=localStorage.getItem("profile-pic")||null,I=localStorage.getItem("profile-name")||"",S=localStorage.getItem("profile-email")||"",a={language:localStorage.getItem("language"),currency:localStorage.getItem("currency"),theme:localStorage.getItem("vite-ui-theme")},N={expenses:s,income:g,notes:r,passcodes:d,profile:{profilePic:i,profileName:I,profileEmail:S},settings:a,exportDate:new Date().toISOString(),version:"1.0",userEmail:c},v="-------314159265358979323846",y=`\r
--${v}\r
`,C=`\r
--${v}--`,D={name:`finance-backup-${new Date().toISOString().split("T")[0]}.json`,mimeType:"application/json"},U=y+`Content-Type: application/json\r
\r
`+JSON.stringify(D)+y+`Content-Type: application/json\r
\r
`+JSON.stringify(N)+C;window.gapi.client.request({path:"/upload/drive/v3/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":`multipart/related; boundary="${v}"`},body:U}).then(()=>{l({title:t("exportSuccessful")||"Export Successful",description:t("exportSuccessDesc")||"Backup uploaded to Google Drive successfully."}),h(!1),$(),K.current=!0},B=>{l({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to upload backup to Google Drive.",variant:"destructive"}),h(!1),console.error("Google Drive upload error",B)})}catch(s){l({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to prepare backup data.",variant:"destructive"}),h(!1),console.error(s)}},x=(s,g)=>{k(!0),window.gapi.client.drive.files.get({fileId:s,alt:"media"}).then(r=>{const d=r.body||JSON.stringify(r.result),i=JSON.parse(d);if(i.expenses&&localStorage.setItem("expenses",JSON.stringify(i.expenses)),i.income&&localStorage.setItem("income",JSON.stringify(i.income)),i.notes&&localStorage.setItem("finance-notes",JSON.stringify(i.notes)),i.passcodes&&localStorage.setItem("passcodes",JSON.stringify(i.passcodes)),i.profile){const{profilePic:I,profileName:S,profileEmail:a}=i.profile;I&&localStorage.setItem("profile-pic",I),S&&localStorage.setItem("profile-name",S),a&&localStorage.setItem("profile-email",a)}i.settings&&(i.settings.language&&localStorage.setItem("language",i.settings.language),i.settings.currency&&localStorage.setItem("currency",i.settings.currency),i.settings.theme&&localStorage.setItem("vite-ui-theme",i.settings.theme)),l({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||`Backup "${g}" imported successfully. Please refresh the page.`})}).catch(r=>{l({title:t("importFailed")||"Import Failed",description:t("importFailedDesc")||"Failed to download or import backup from Google Drive.",variant:"destructive"}),console.error(r)}).finally(()=>{k(!1)})},b=()=>{if(!V||!F.current){l({title:t("pickerNotReady")||"Picker Not Ready",description:t("signInFirst")||"Please sign in to Google Drive first.",variant:"destructive"});return}const s=new window.google.picker.DocsView(window.google.picker.ViewId.DOCS);s.setMimeTypes("application/json"),s.setSelectFolderEnabled(!1),s.setIncludeFolders(!1),s.setQuery("finance-backup"),new window.google.picker.PickerBuilder().addView(s).setOAuthToken(F.current).setDeveloperKey(se).setCallback(r=>{if(r.action===window.google.picker.Action.PICKED){const d=r.docs[0];d&&d.id&&x(d.id,d.name)}}).build().setVisible(!0)},z=()=>{if(!n){h(!0);try{const s=JSON.parse(localStorage.getItem("expenses")||"[]"),g=JSON.parse(localStorage.getItem("income")||"[]"),r=JSON.parse(localStorage.getItem("finance-notes")||"[]"),d=JSON.parse(localStorage.getItem("passcodes")||"[]"),i=localStorage.getItem("profile-pic")||null,I=localStorage.getItem("profile-name")||"",S=localStorage.getItem("profile-email")||"",a={language:localStorage.getItem("language"),currency:localStorage.getItem("currency"),theme:localStorage.getItem("vite-ui-theme")},N=["Type,Date,Amount,Category,Description,Account",...s.map(m=>`Expense,${m.date},${m.amount},${m.category},"${m.description}",${m.account||""}`),...g.map(m=>`Income,${m.date},${m.amount},${m.category},"${m.description}",${m.account||""}`)].join(`
`),v={expenses:s,income:g,notes:r,passcodes:d,profile:{profilePic:i,profileName:I,profileEmail:S},settings:a,exportDate:new Date().toISOString(),version:"1.0",userEmail:c},y=new Blob([N],{type:"text/csv"}),C=window.URL.createObjectURL(y),D=document.createElement("a");D.href=C,D.download=`finance-backup-${new Date().toISOString().split("T")[0]}.csv`,D.click(),window.URL.revokeObjectURL(C);const U=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),B=window.URL.createObjectURL(U),L=document.createElement("a");L.href=B,L.download=`finance-backup-${new Date().toISOString().split("T")[0]}.json`,L.click(),window.URL.revokeObjectURL(B),l({title:t("exportSuccessful")||"Export Successful",description:t("exportSuccessDesc")||"Your data has been exported successfully."}),K.current=!0}catch{l({title:t("exportFailed")||"Export Failed",description:t("exportFailedDesc")||"Failed to export data. Please try again.",variant:"destructive"})}finally{h(!1)}}},M=s=>{var d;const g=(d=s.target.files)==null?void 0:d[0];if(!g)return;k(!0);const r=new FileReader;r.onload=i=>{var I;try{const S=(I=i.target)==null?void 0:I.result;if(g.name.endsWith(".json")){const a=JSON.parse(S);if(a.expenses&&localStorage.setItem("expenses",JSON.stringify(a.expenses)),a.income&&localStorage.setItem("income",JSON.stringify(a.income)),a.notes&&localStorage.setItem("finance-notes",JSON.stringify(a.notes)),a.passcodes&&localStorage.setItem("passcodes",JSON.stringify(a.passcodes)),a.profile){const{profilePic:N,profileName:v,profileEmail:y}=a.profile;N&&localStorage.setItem("profile-pic",N),v&&localStorage.setItem("profile-name",v),y&&localStorage.setItem("profile-email",y)}a.settings&&(a.settings.language&&localStorage.setItem("language",a.settings.language),a.settings.currency&&localStorage.setItem("currency",a.settings.currency),a.settings.theme&&localStorage.setItem("vite-ui-theme",a.settings.theme)),l({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||"Your data has been imported successfully. Please refresh the page."})}else if(g.name.endsWith(".csv")){const a=S.split(`
`),N=[],v=[];for(let y=1;y<a.length;y++){const C=a[y].trim();if(!C)continue;const[D,U,B,L,m,ie]=C.split(","),te={date:U,amount:parseFloat(B),category:L,description:(m==null?void 0:m.replace(/(^"|"$)/g,""))||"",account:ie||""};D==="Expense"?N.push(te):D==="Income"&&v.push(te)}localStorage.setItem("expenses",JSON.stringify(N)),localStorage.setItem("income",JSON.stringify(v)),l({title:t("importSuccessful")||"Import Successful",description:t("importSuccessDesc")||"Your CSV data has been imported successfully. Please refresh the page."})}else l({title:t("importFailed")||"Import Failed",description:t("unsupportedFileFormat")||"Unsupported file format.",variant:"destructive"})}catch(S){l({title:t("importFailed")||"Import Failed",description:t("importFailedDesc")||"Failed to import data. Please check the file and try again.",variant:"destructive"}),console.error(S)}finally{k(!1)}},r.readAsText(g)};return e.jsx("div",{className:"space-y-6",children:e.jsxs(P,{className:"shadow-soft",children:[e.jsxs(E,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),t("backupData")||"Backup Data"]}),e.jsx(_,{children:t("backupDataDescription")||"Export and import your financial data"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(ae,{children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx(oe,{children:t("backupWarning")||"Backup includes all your transactions, notes, passcodes, profile info, and settings. Keep your backups secure."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{className:"text-lg",children:t("exportData")||"Export Data"}),e.jsx(_,{children:t("exportDataDescription")||"Download your data as CSV or JSON file"})]}),e.jsxs(T,{children:[e.jsxs(j,{onClick:z,disabled:n,className:"w-full mb-2",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),n?t("exporting")||"Exporting...":t("exportToFile")||"Export to CSV & JSON"]}),e.jsxs(j,{onClick:u,disabled:n,className:"w-full mb-2",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),n?t("exporting")||"Exporting...":t("backupToGoogleDrive")||"Backup to Google Drive"]}),J&&e.jsx(j,{onClick:H,variant:"ghost",className:"w-full mb-4",children:t("signOutFromGoogle")||"Sign Out from Google"}),!J&&e.jsx(j,{onClick:q,variant:"outline",className:"w-full mb-4",children:t("signInToGoogleDrive")||"Sign In to Google Drive"})]})]}),e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{className:"text-lg",children:t("importData")||"Import Data"}),e.jsx(_,{children:t("importDataDescription")||"Import data from CSV or JSON file or Google Drive"})]}),e.jsxs(T,{children:[e.jsx("input",{type:"file",accept:".csv,.json",id:"fileInput",onChange:M,disabled:p,className:"hidden"}),e.jsx("label",{htmlFor:"fileInput",className:"cursor-pointer block w-full mb-2",children:e.jsxs(j,{className:"w-full",disabled:p,children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),p?t("importing")||"Importing...":t("importFromFile")||"Import from File"]})}),e.jsxs(j,{onClick:b,disabled:!J||p,variant:"outline",className:"w-full",children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),t("restoreFromDrivePicker")||"Restore from Google Drive Picker"]})]})]})]}),G.length>0&&e.jsx("div",{className:"mt-6",children:e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{children:t("backupsOnDrive")||"Backups on Google Drive"}),e.jsx(_,{children:t("selectBackupToRestore")||"Select a backup file to restore your data"})]}),e.jsx(T,{children:e.jsx("ul",{className:"space-y-2 max-h-48 overflow-auto",children:G.map(s=>e.jsxs("li",{className:"flex justify-between items-center border rounded p-2 hover:bg-gray-50 cursor-pointer",children:[e.jsx("span",{children:s.name}),e.jsxs(j,{size:"sm",onClick:()=>x(s.id,s.name),disabled:p,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),t("restore")||"Restore"]})]},s.id))})})]})})]})]})})},be=o.createContext({theme:"light",toggleTheme:()=>{}}),De=()=>o.useContext(be),Oe=({onUnlock:f})=>{ee();const{t:c}=Z(),{theme:n,toggleTheme:h}=De(),[p,k]=o.useState(!1);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(P,{children:[e.jsxs(E,{children:[e.jsx(R,{children:c("settings")}),e.jsx(_,{children:"manageAppSecuritySettings"})]}),e.jsx(T,{className:"space-y-4",children:e.jsx(he,{onUnlock:f})})]}),e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{children:"backupAndRestore"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsx(j,{className:"flex items-center gap-2",onClick:()=>k(!p),children:p?"hideBackupManager":"openBackupManager"}),p&&e.jsx(ke,{})]})]})]})};async function Fe(f,c){const n=Se.auth.getToken().access_token,h={name:c,mimeType:f.type},p=new FormData;return p.append("metadata",new Blob([JSON.stringify(h)],{type:"application/json"})),p.append("file",f),(await fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart&fields=id",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:p})).json()}const Je=({onUnlock:f})=>{const[c,n]=o.useState(null),[h,p]=o.useState(null),[k,A]=o.useState("profile-picture.png"),[W,V]=o.useState(!1),[Y,J]=o.useState(""),[O,G]=o.useState(""),{toast:w}=ee();Z();const t=o.useRef(null),[l,K]=o.useState(!1);o.useEffect(()=>{const u=localStorage.getItem("profile-pic"),x=localStorage.getItem("profile-name"),b=localStorage.getItem("profile-email");u&&n(u),x&&J(x),b&&G(b)},[]);const F=u=>{var z;const x=(z=u.target.files)==null?void 0:z[0];if(!x)return;p(x),A(x.name);const b=new FileReader;b.onload=async()=>{const M=b.result;n(M),localStorage.setItem("profile-pic",M),w({title:"profile Picture Set Success"});try{V(!0),await Fe(x,x.name),w({title:"upload Drive Success"})}catch{w({title:"uploadFailed",variant:"destructive"})}finally{V(!1)}},b.readAsDataURL(x)},q=()=>{localStorage.removeItem("profile-pic"),n(null),p(null),w({title:"profile PicRemoved"})},H=u=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(u),$=()=>{if(O&&!H(O)){w({title:"invalid Email",variant:"destructive"});return}localStorage.setItem("profile-name",Y.trim()),localStorage.setItem("profile-email",O.trim()),w({title:"profileS aved"})};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-10",children:[e.jsxs(P,{children:[e.jsx(E,{children:e.jsx(R,{children:"user Profile"})}),e.jsx(T,{className:"space-y-6",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative group w-32 h-32",children:[c?e.jsx("img",{src:c,alt:"Profile",className:"w-full h-full rounded-full object-cover border"}):e.jsx("div",{className:"w-full h-full rounded-full bg-muted flex items-center justify-center text-muted-foreground",children:e.jsx(me,{size:32})}),e.jsx("button",{onClick:()=>{var u;return(u=t.current)==null?void 0:u.click()},className:"absolute bottom-0 right-0 p-2 rounded-full bg-primary text-primary-foreground opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"changeProfilePic",children:e.jsx(ge,{size:16})})]}),e.jsx(Q,{type:"file",accept:"image/*",onChange:F,className:"hidden",ref:t}),c&&e.jsx("div",{className:"w-full max-w-sm mt-4",children:e.jsx(j,{onClick:q,variant:"ghost",className:"w-full",children:"removePhoto"})}),e.jsxs("div",{className:"w-full max-w-sm space-y-3 mt-6",children:[e.jsx(Q,{type:"text",value:Y,onChange:u=>J(u.target.value),placeholder:"your Full Name"}),e.jsx(Q,{type:"email",value:O,onChange:u=>G(u.target.value),placeholder:"your Email"}),e.jsx(j,{onClick:$,className:"w-full",children:W?e.jsx(fe,{}):"save Changes"})]})]})})]}),e.jsx(j,{onClick:()=>K(!l),className:"flex items-center gap-4",children:l?"hide Settings":"open Settings"}),l&&e.jsx(Oe,{onUnlock:f})]})};export{Je as default};
